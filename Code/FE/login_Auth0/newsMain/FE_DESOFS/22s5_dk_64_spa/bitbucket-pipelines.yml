image: node:16

pipelines:
  default:
    - parallel:
        - step:
            name: Build and Test
            caches:
              - node
            script:
              - apt-get update && apt-get install -yq libgconf-2-4
              - apt-get update && apt-get install -y wget --no-install-recommends
              - wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add -
              - sh -c 'echo "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" >> /etc/apt/sources.list.d/google.list'
              - apt-get update
              - apt-get install -y google-chrome-unstable fonts-ipafont-gothic fonts-wqy-zenhei fonts-thai-tlwg fonts-kacst --no-install-recommends
              - npm install
              - npm run build
              - npm run test:ci
              - apt update && apt install zip
              # Exclude files to be ignored
              - zip -r app-$BITBUCKET_BUILD_NUMBER.zip ./dist
            artifacts:
              - "*.zip"
